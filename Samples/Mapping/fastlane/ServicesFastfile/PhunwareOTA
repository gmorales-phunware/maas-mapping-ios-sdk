lane :jenkins_setup do

  # setup jenkins variables
  if is_ci?
    ENV['PH_OTA_UPLOAD'] = ENV['OTA']

    # set build number to build job number
    increment_build_number(
      build_number: ENV['BUILD_NUMBER']
    )

    # remove build directory
    sh "rm -rf build"

    # Set output directory
    output_directory_path = File.expand_path("../build/output")
    UI.message "Set output directory path to: \"#{output_directory_path}\"."
    ENV['GYM_BUILD_PATH'] = output_directory_path
    ENV['GYM_OUTPUT_DIRECTORY'] = output_directory_path
    ENV['SCAN_OUTPUT_DIRECTORY'] = output_directory_path
    ENV['BACKUP_XCARCHIVE_DESTINATION'] = output_directory_path

    derived_data_path = File.expand_path("../build/derivedData")
    UI.message "Set derived data path to: \"#{derived_data_path}\"."
    ENV['DERIVED_DATA_PATH'] = derived_data_path # Used by clear_derived_data.
    ENV['XCODE_DERIVED_DATA_PATH'] = derived_data_path
    ENV['GYM_DERIVED_DATA_PATH'] = derived_data_path
    ENV['SCAN_DERIVED_DATA_PATH'] = derived_data_path
    ENV['FL_CARTHAGE_DERIVED_DATA'] = derived_data_path

  end

end

lane :jenkins_cleanup do

  # then print out Jenkins description
  puts "OTA URLs: #{lane_context[SharedValues::OTA_URLS]}"

end
